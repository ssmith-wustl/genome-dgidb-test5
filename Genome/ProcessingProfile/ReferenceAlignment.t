#!/gsc/bin/perl

use strict;
use warnings;

$ENV{UR_DBI_NO_COMMIT} = 1;
$ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;

use Test::More tests => 5;

use above "Genome";

BEGIN {
    use_ok('Genome::ProcessingProfile::ReferenceAlignment');
}

my %params = (
              profile_name => 1,
              read_aligner => 'maq0_6_3',
              reference_sequence => 'test ref seq',
              dna_type => 'genomic dna',
              bare_args => [],
          );
my $create_ra = Genome::Model::Command::Create::ProcessingProfile::ReferenceAlignment->create(%params);
ok($create_ra->execute,'create first processing profile');

my %get_params = (
                  read_aligner_name => $params{read_aligner},
                  reference_sequence_name => $params{reference_sequence},
                  dna_type => $params{dna_type},
              );

my @ras = Genome::ProcessingProfile::ReferenceAlignment->get(%get_params);
is(scalar(@ras),1,"expected 1 reference alignment processing profile");

$params{profile_name}++;
$create_ra = Genome::Model::Command::Create::ProcessingProfile::ReferenceAlignment->create(%params);
ok(!$create_ra->execute,'correctly failed to create duplicate processing profile');

@ras = Genome::ProcessingProfile::ReferenceAlignment->get(%get_params);
is(scalar(@ras),1,"expected 1 reference alignment processing profile");
print $ras[0]->name ."\n";


exit;
